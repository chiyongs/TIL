# 캐시 전략

Caching에 적합한 데이터의 요건

- 자주 조회됨
- 데이터의 결과값이 일정
- 연산이 무거움

캐시 레이어를 사용하게 되면 데이터베이스와의 데이터 정합성 문제가 따라온다.
이런 캐시와 DB의 데이터 불일치 문제를 극복하면서 성능을 향상시키기 위해 여러 캐시 전략들이 존재한다.

## 읽기 캐시 전략, Read Cache Strategy

### Cache Aside (Look Aside)

1. 캐시에 데이터가 존재한다면 클라이언트로 반환
2. 캐시에 데이터가 존재하지 않는다면, DB에서 데이터 조회
3. 데이터를 클라이언트에 반환하며, 캐시에 데이터를 저장

→ 캐시에 장애가 발생해도 서비스에 지장이 없음

하지만, 초기 호출 시 무조건 DB를 호출하므로 단 건에 대한 호출이 많은 경우 좋지 않다.
반복적인 작업 수행 시 적합

### Read Through

1. 캐시에 데이터가 존재한다면 클라이언트로 반환
2. 캐시에 데이터가 없다면, DB에서 데이터 조회
3. 데이터를 캐시에 저장한 후 클라이언트로 데이터 반환

→ 캐시 의존성이 높기 때문에 fail-over 시스템 구축 필요

Cache Aside 방식과 유사하지만, Cache에 데이터를 저장하는 주체가 다르다.
Cache Aside & Read Through : 데이터를 처음 읽는 경우 Cache Miss 발생 → 속도 저하

> Thundering Herd

읽기 캐시에서 발생할 수 있는 문제
캐시가 비어있는 경우 많은 요청이 캐시를 갱신하느라 장애로 이어질 수 있음
→ 캐시에 데이터를 미리 세팅하는 Cache Warm Up 방식을 적용하거나, 첫 요청으로 캐시가 갱신될 때까지 다른 요청들은 기다리도록 동기화 작업이 필요

## 쓰기 캐시 전략, Write Cache Strategy

- Write Around : 캐시를 갱신하지 않음
- Write Through : 캐시를 바로 갱신
- Write Back : 캐시를 모아서 나중에 갱신

### Write Around

캐시 만료 전까지 캐시를 갱신하지 않음
데이터의 갱신, 만료는 DB에만 반영

### Write Through

1. 캐시에 데이터를 추가하거나 변경
2. 캐시가 DB에 동기적으로 데이터 갱신
3. 캐시 데이터를 클라이언트에 반환

→ 캐시를 항상 최신 상태로 유지

데이터를 동기화한 후 반환하므로 속도가 느림

### Write Back

캐시와 DB 동기화를 비동기로 처리
쓰기 작업이 많은 경우에 적합
캐시에서 일정량의 데이터를 모아놓았다가 한 번에 DB에 업데이트 → 쓰기 비용 절약
구현이 복잡하며 캐시에 장애 발생 시 데이터가 유실됨

### Refresh Ahead

자주 사용되는 캐시를 만료전에 미리 갱신 → 캐시 미스가 줄어듬
하지만, 자주 사용되는 데이터를 잘 예측해야 함
