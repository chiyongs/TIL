# 아이템 47. 반환 타입으로는 스트림보다 컬렉션이 낫다

## 원소 시퀀스 메서드의 반환타입

자바 7까지는 원소 시퀀스, 즉 일련의 원소를 반환하는 메서드의 반환 타입으로 Collection, Set, List 같은 컬렉션 인터페이스 혹은 Iterable이나 배열을 사용했다.
자바 8에서 스트림의 등장으로 이 선택이 아주 복잡한 일이 되어버렸다.

스트림은 반복(iteration)을 지원하지 않는다.
Stream 인터페이스는 Iterable 인터페이스가 정의한 추상 메서드를 전부 포함할 분만 아니라, Iterable 인터페이스가 정의한 방식대로 동작하지만, for-each로 스트림을 반복할 수 없다.
→ Stream이 Iterable을 확장하지 않음

### Collection

객체 시퀀스를 반환하는 메서드를 작성하는데, 해당 메서드가 오직 스트림 파이프라인에서만 사용된다면 스트림을 반환하도록 해도 좋다.
하지만, 반환된 객체들이 반복문에서만 쓰일 걸 안다면 Iterable을 반환하자.
원소 시퀀스를 반환하는 공개 API의 반환 타입에는 Collection이나 그 하위 타입을 쓰는게 일반적으로 최선이다.
→ Collection 인터페이스는 Iterable의 하위 타입이고 stream 메서드도 제공하기 때문 (반복과 스트림 동시 지원)
하지만, 단지 컬렉션을 반환한다는 이유로 덩치 큰 시퀀스를 메모리에 올려서는 안 된다.
이런 경우 `AbstractList` 를 사용하여 전용 컬렉션을 구현해서 해결하는 방법도 존재한다.

### `AbstractCollection`

AbstarctCollection을 활용해서 Collection 구현체를 작성할 때는 Iterable용 메서드 외에 2개만 추가 구현하면 된다.
→ contains와 size
만약, 반복이 시작되기 전에 시퀀스의 내용을 확정할 수 없는 등의 사유로 contains와 size를 구현 불가능할 때는 스트림이나 Iterable을 반환하는 편이 좋다.

## 정리

- 원소 시퀀스를 반환하는 메서드를 작성할 때는 컬렉션을 반환할 수 있다면 컬렉션을 반환하자.
- 반환 전부터 이미 원소들을 컬렉션에 담아 관리하고 있거나 컬렉션을 하나 더 만들어도 될 정도로 원소 개수가 적다면 표준 컬렉션에 담아 반환하자.
- 그렇지 않다면 전용 컬렉션을 구현하는 것을 고민하자.
- 컬렉션 반환이 불가능하다면 스트림이나 Iterable 중 자연스러운 것을 반환하자.
