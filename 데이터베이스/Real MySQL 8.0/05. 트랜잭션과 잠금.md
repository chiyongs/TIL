# 5.1 트랜잭션

## 트랜잭션

트랜잭션 : 작업의 완전성을 보장해주는 기능 → 논리적인 작업 세트가 100% 처리되거나, 원상태로 복구되거나를 보장해줌

- 락 : 동시성을 제어하기 위한 기능
- 트랜잭션 : 데이터의 정합성을 위한 기능

MySQL에는 3가지 스토리지 엔진 존재

- MyISAM → 트랜잭션 미지원
- MEMORY → 트랜잭션 미지원
- InnoDB → 트랜잭션 지원

트랜잭션을 지원하지 않으면 부분 실행이라는 것이 발생할 수 있다.
부분 실행은 쿼리 수행 시 예외가 발생했거나 실패했을 때 해당하는 쿼리 전으로는 적용되는 것을 말함
따라서, 부분 실행으로 인해 변경된 데이터에 대해서 어떻게 처리할 것인가에 대한 고민이 필요함.
→ 트랜잭션이 애플리케이션을 개발하는 데 있어 고민할 부분을 덜어준다고 볼 수 있음

트랜잭션은 DB 커넥션처럼 최소화해서 사용하는 것이 좋음.

## 락

- MySQL 엔진 : 스토리지 엔진을 제외한 MySQL
  - MySQL 엔진 레벨의 락은 스토리지 엔진 레벨 락에 영향을 준다.
- 스토리지 엔진

### MySQL 엔진 락 종류

글로벌 락

- 모든 세션에 대해 잠금하는 락
- 조회를 제외한 모든 작업이 불가능
- `FLUSH TABLES WITH READ LOCK`

백업 락

- 특정 세션에 대해 잠금하는 락
- 데이터베이스 및 테이블 같은 객체 생성,변경,삭제 금지 & 사용자 권한 및 비밀번호 변경 금지
- but, 일반적인 테이블의 데이터 변경은 허용
- `LOCK INSTANCE FOR BACKUP`

테이블 락

- 개별 테이블을 잠금하거나 해제하는 락
- 명시적 또는 묵시적으로 획득할 수 있음
- `LOCK TABLES table_name [ READ | WRITE ]`
- InnoDB에서 데이터 변경 시 테이블 락 적용, 대부분 DML들은 락을 무시, 스키마를 변경하는 등의 DDL은 락에 영향받음

네임드 락

- 사용자가 지정한 문자열을 잠금하거나 해제하는 락
- 잘 쓰이지는 않으나, 많은 레코드에 대해 복잡한 조건으로 변경을 진행하는 배치 작업에서 동시성을 위해 사용할 수 있음
- `SELECT GET_LOCK('mylock', 2)` : "mylock" 문자열에 대해 락을 획득
- `SELECT IS_FREE_LOCK('mylock')` : "mylock" 문자열에 대해 락이 설정되어 있는지 확인
- `SELECT RELEASE_LOCK('mylock)` : "mylock" 문자열에 대해 획득했던 락을 반납

메타데이터 락

- 데이터베이스 객체의 이름이나 구조 변경 시 걸리는 락
- 명시적으로 획득할 수 없음
- `RENAME TABLE table_a TO table_b`
