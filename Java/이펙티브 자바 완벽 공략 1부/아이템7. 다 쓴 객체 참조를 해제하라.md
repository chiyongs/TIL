# 아이템7. 다 쓴 객체 참조를 해제하라.

자바에 가비지 컬렉션이 있지만 메모리 누수가 발생할 수 있다.

메모리 누수가 발생할 수 있는 경우는 3가지 정도가 있다.

1. Stack
   1. Pop 메서드에서 메모리 누수가 발생할 수 있다.

      ```java
      // 메모리 누수가 발생할 수 있는 경우
      public Object pop() {
      	if(size == 0) throw new EmptyStackException();
      	return elements[--size];
      }

      // 메모리 누수 해결 pop
      public Object pop() {
      	if(size == 0) throw new EmptyStackException();
      	Object result = elements[--size];
      	elements[size] = null; // 다 쓴 참조 해제
      	return result;
      }
      ```
2. Cache
3. Listener

이 경우들의 공통점은 배열이나 Set, List, Map 등 컬렉션에 데이터를 담고 있는 경우이다.
쌓아둔 데이터를 언제 참조 해제해줘야 할지 고민해야 한다.

참조 해제하는 방법

1. null로 처리하기 (다 쓴 참조를 해제하는 명시적인 방법)
2. WeakReference 또는 WeakHashMap 사용하기
   1. WeakReference : GC의 대상이 되는 객체
   2. WeakHashMap : WeakReference를 key로 사용하는 Map
      1. WeakHashMap의 key가 더 이상 참조되지 않으면 GC에 의해 수거된다.
3. 객체를 넣거나 빼거나 할 때 직접 삭제하는 방법 (LRU 등의 자료구조 활용)
4. Background Thread로 주기적으로 clean up 작업 실행 (ScheduledThreadPoolExecutor)
