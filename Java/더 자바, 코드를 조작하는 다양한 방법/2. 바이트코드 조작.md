# 바이트코드 조작

## 코드 커버리지는 어떻게 측정할까?

코드 커버리지 : 테스트 코드가 소스 코드의 어느정도를 커버하는지에 대한 비율

JaCoCo : 코드 커버리지 분석 툴

코드 커버리지 분석 툴이 만들어지는 방법 : 바이트 코드를 읽어서 코드 커버리지를 챙겨야하는 부분을 다 마킹해두고 테스트 코드를 실행하며 어느 부분을 지나갔는지 전부 체크한다.

## 바이트 코드 조작

바이트 코드 조작은 마술같다.

바이트 코드 조작 라이브러리

- ASM, Javassist, ByteBuddy

바이트 코드를 조작해놓으면 다시 컴파일을 하기 전까지 해당 바이트 코드로 실행된다.

### javaagent 실습

`premain` : 자바 애플리케이션을 시작할 때 agent를 붙이는 방식

`agentmain` : 런타임 중 동적으로 붙이는 방식

이 방식은 파일 시스템을 변경하는 것이 아니라 클래스로더가 클래스를 읽어올 때 javaagent를 거쳐 변경된 바이트 코드를 사용한다.

### 바이트 코드 조작으로 할 수 있는 일

- 프로그램 분석
  - 코드에서 버그를 찾는 툴
  - 코드 복잡도 계산
- 클래스 파일 생성
  - 프록시
  - 특정 API 호출 접근 제한
  - 스칼라 같은 언어의 컴파일러
- 그 외에도 자바 소스 코드를 건드리지 않고 코드 변경이 필요한 경우 사용 가능
  - 프로파일러
  - 최적화
  - 로깅
